{% extends 'base.html' %}
{% block content %}

<div class="container mt-4">

    <!-- Page Title -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="fw-bold text-primary">RTI Requests</h2>
        <a href="/create/" class="btn btn-success">+ Create New RTI</a>
    </div>

    <!-- Filters Card -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <form method="get" class="row g-3">

                <!-- Search -->
                <div class="col-md-3">
                    <input type="text"
                           name="q"
                           class="form-control"
                           placeholder="Search by name or reference"
                           value="{{ query }}">
                </div>

                <!-- Panchayat Filter -->
                <div class="col-md-3">
                    <select name="panchayat" class="form-select">
                        <option value="">All Panchayats</option>
                        {% for p in panchayats %}
                            <option value="{{ p.id }}"
                                {% if p.id|stringformat:"s" == selected_panchayat %}selected{% endif %}>
                                {{ p.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Status Filter -->
                <div class="col-md-2">
                    <select name="status" class="form-select">
                        <option value="">All Status</option>
                        <option value="COMPLETE" {% if selected_status == "COMPLETE" %}selected{% endif %}>Complete</option>
                        <option value="VAGUE" {% if selected_status == "VAGUE" %}selected{% endif %}>Vague</option>
                        <option value="DENIED" {% if selected_status == "DENIED" %}selected{% endif %}>Denied</option>
                        <option value="DELAYED" {% if selected_status == "DELAYED" %}selected{% endif %}>Delayed</option>
                    </select>
                </div>

                <!-- Sorting -->
                <div class="col-md-2">
                    <select name="sort" class="form-select">
                        <option value="">Sort By</option>
                        <option value="date_asc" {% if selected_sort == "date_asc" %}selected{% endif %}>Date Asc</option>
                        <option value="date_desc" {% if selected_sort == "date_desc" %}selected{% endif %}>Date Desc</option>
                        <option value="status" {% if selected_sort == "status" %}selected{% endif %}>Status</option>
                    </select>
                </div>

                <!-- Button -->
                <div class="col-md-2 d-grid">
                    <button type="submit" class="btn btn-primary">Apply Filters</button>
                </div>

            </form>
        </div>
    </div>

    <!-- RTI List -->
    {% for rti in page_obj %}
        <div class="card shadow-sm mb-3">
            <div class="card-body">
                <h5 class="card-title text-dark">
                    {{ rti.reference_number }}
                </h5>

                <p class="mb-1">
                    <strong>Applicant:</strong> {{ rti.applicant_name }}
                </p>

                <p class="mb-1">
                    <strong>Date Filed:</strong> {{ rti.date_filed }}
                </p>

                <p class="mb-2">
                    <strong>Panchayat:</strong> {{ rti.panchayat.name }}
                </p>

                <a href="/{{ rti.id }}/" class="btn btn-outline-primary btn-sm">
                    View Details
                </a>
            </div>
        </div>
    {% empty %}
        <div class="alert alert-warning">
            No RTI requests found.
        </div>
    {% endfor %}

    <!-- Pagination -->
    {% if page_obj.paginator.num_pages > 1 %}
    <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination justify-content-center">

            {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link"
                       href="?page=1&q={{ query }}&panchayat={{ selected_panchayat }}&status={{ selected_status }}&sort={{ selected_sort }}">
                        &laquo; First
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ page_obj.previous_page_number }}&q={{ query }}&panchayat={{ selected_panchayat }}&status={{ selected_status }}&sort={{ selected_sort }}">
                        Previous
                    </a>
                </li>
            {% endif %}

            <li class="page-item active">
                <span class="page-link">
                    Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
                </span>
            </li>

            {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ page_obj.next_page_number }}&q={{ query }}&panchayat={{ selected_panchayat }}&status={{ selected_status }}&sort={{ selected_sort }}">
                        Next
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ page_obj.paginator.num_pages }}&q={{ query }}&panchayat={{ selected_panchayat }}&status={{ selected_status }}&sort={{ selected_sort }}">
                        Last &raquo;
                    </a>
                </li>
            {% endif %}

        </ul>
    </nav>
    {% endif %}

</div>

{% endblock %}
